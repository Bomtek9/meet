{"ast":null,"code":"// src/api.js\n\nimport mockData from \"./mock-data\";\nexport const extractLocations = events => {\n  const extractedLocations = events.map(event => event.location);\n  const locations = [...new Set(extractedLocations)];\n  return locations;\n};\nconst checkToken = async accessToken => {\n  const response = await fetch(`https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=${accessToken}`);\n  const result = await response.json();\n  return result;\n};\nexport const getAccessToken = async () => {\n  const accessToken = localStorage.getItem(\"access_token\");\n  const tokenCheck = accessToken && (await checkToken(accessToken));\n  if (!accessToken || tokenCheck.error) {\n    await localStorage.removeItem(\"access_token\");\n    const searchParams = new URLSearchParams(window.location.search);\n    const code = await searchParams.get(\"code\");\n    if (!code) {\n      const response = await fetch(\"https://k6z8ae60ne.execute-api.eu-central-1.amazonaws.com/dev/api/get-auth-url\");\n      const result = await response.json();\n      const {\n        authUrl\n      } = result;\n      return window.location.href = authUrl;\n    }\n    return code && getToken(code);\n  }\n  return accessToken;\n};\nconst getToken = async code => {\n  const encodeCode = encodeURIComponent(code);\n  const response = await fetch(\"https://k6z8ae60ne.execute-api.eu-central-1.amazonaws.com/dev/api/token\" + \"/\" + encodeCode);\n  const {\n    access_token\n  } = await response.json();\n  access_token && localStorage.setItem(\"access_token\", access_token);\n  return access_token;\n};\nexport const getEvents = async () => {\n  if (window.location.href.startsWith(\"http://localhost\")) {\n    return mockData;\n  }\n  const token = await getAccessToken();\n  if (token) {\n    removeQuery();\n    const url = \"https://k6z8ae60ne.execute-api.eu-central-1.amazonaws.com/dev/api/get-events\" + \"/\" + token;\n    const response = await fetch(url);\n    const result = await response.json();\n    if (result) {\n      return result.events;\n    } else {\n      return null;\n    }\n  }\n};\nconst removeQuery = () => {\n  let newurl;\n  if (window.history.pushState && window.location.pathname) {\n    newurl = window.location.protocol + \"//\" + window.location.host + window.location.pathname;\n    window.history.pushState(\"\", \"\", newurl);\n  } else {\n    newurl = window.location.protocol + \"//\" + window.location.host;\n    window.history.pushState(\"\", \"\", newurl);\n  }\n};","map":{"version":3,"names":["mockData","extractLocations","events","extractedLocations","map","event","location","locations","Set","checkToken","accessToken","response","fetch","result","json","getAccessToken","localStorage","getItem","tokenCheck","error","removeItem","searchParams","URLSearchParams","window","search","code","get","authUrl","href","getToken","encodeCode","encodeURIComponent","access_token","setItem","getEvents","startsWith","token","removeQuery","url","newurl","history","pushState","pathname","protocol","host"],"sources":["/Users/clayduplantis/Documents/GitHub/meet/src/api.js"],"sourcesContent":["// src/api.js\n\nimport mockData from \"./mock-data\";\n\nexport const extractLocations = (events) => {\n  const extractedLocations = events.map((event) => event.location);\n  const locations = [...new Set(extractedLocations)];\n  return locations;\n};\n\nconst checkToken = async (accessToken) => {\n  const response = await fetch(\n    `https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=${accessToken}`\n  );\n  const result = await response.json();\n  return result;\n};\n\nexport const getAccessToken = async () => {\n  const accessToken = localStorage.getItem(\"access_token\");\n\n  const tokenCheck = accessToken && (await checkToken(accessToken));\n\n  if (!accessToken || tokenCheck.error) {\n    await localStorage.removeItem(\"access_token\");\n    const searchParams = new URLSearchParams(window.location.search);\n    const code = await searchParams.get(\"code\");\n\n    if (!code) {\n      const response = await fetch(\n        \"https://k6z8ae60ne.execute-api.eu-central-1.amazonaws.com/dev/api/get-auth-url\"\n      );\n      const result = await response.json();\n      const { authUrl } = result;\n      return (window.location.href = authUrl);\n    }\n\n    return code && getToken(code);\n  }\n\n  return accessToken;\n};\n\nconst getToken = async (code) => {\n  const encodeCode = encodeURIComponent(code);\n  const response = await fetch(\n    \"https://k6z8ae60ne.execute-api.eu-central-1.amazonaws.com/dev/api/token\" +\n      \"/\" +\n      encodeCode\n  );\n  const { access_token } = await response.json();\n  access_token && localStorage.setItem(\"access_token\", access_token);\n\n  return access_token;\n};\n\nexport const getEvents = async () => {\n  if (window.location.href.startsWith(\"http://localhost\")) {\n    return mockData;\n  }\n\n  const token = await getAccessToken();\n\n  if (token) {\n    removeQuery();\n    const url =\n      \"https://k6z8ae60ne.execute-api.eu-central-1.amazonaws.com/dev/api/get-events\" +\n      \"/\" +\n      token;\n    const response = await fetch(url);\n    const result = await response.json();\n    if (result) {\n      return result.events;\n    } else {\n      return null;\n    }\n  }\n};\n\nconst removeQuery = () => {\n  let newurl;\n  if (window.history.pushState && window.location.pathname) {\n    newurl =\n      window.location.protocol +\n      \"//\" +\n      window.location.host +\n      window.location.pathname;\n    window.history.pushState(\"\", \"\", newurl);\n  } else {\n    newurl = window.location.protocol + \"//\" + window.location.host;\n    window.history.pushState(\"\", \"\", newurl);\n  }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}